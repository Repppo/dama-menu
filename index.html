<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DA·MA Milano — Menu</title>

  <!-- Playfair Display per il wordmark -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0d0f;
      --bg-soft:#0f1215;
      --card:#111418;
      --ink:#e9ecef;
      --muted:#a0a7b0;
      --accent:#e5c07b;
      --accent-strong:#d4a657;
      --radius:16px;
      --ring:rgba(229,192,123,.35);
      --border:rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html{
      -webkit-text-size-adjust:100%; /* evita zoom automatico su iOS */
    }
    html,body{
      margin:0;height:100%;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background:
      radial-gradient(1200px 800px at 10% -10%, rgba(229,192,123,.05), transparent 60%),
      radial-gradient(1000px 600px at 110% -20%, rgba(150, 100, 30,.06), transparent 60%),
      var(--bg);
    }
    a{color:var(--accent)}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.05) blur(6px);
      background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.4));
      border-bottom:1px solid var(--border);
    }
    .bar{
      max-width:1100px; margin:0 auto; padding:10px 12px;
      display:flex; gap:10px; align-items:center;
      flex-wrap:nowrap; /* non spezzare l'header */
    }
    @media (max-width:560px){
      .bar{ gap:8px; } /* continuiamo a NON andare a capo finché possibile */
    }

    /* Wordmark su due righe compatte */
    .brand{display:flex; align-items:center; flex:0 0 auto;}
    .wordmark{
      display:flex; flex-direction:column; align-items:flex-start;
      gap:2px; text-decoration:none; color:#fff; line-height:1.05;
    }
    .wordmark .brand-text{
      font-family:"Playfair Display", serif;
      font-weight:800; letter-spacing:.08em; font-size:22px; line-height:1;
    }
    .wordmark .brand-text .sep{ margin:0 .12em; }
    .wordmark .city{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      font-weight:600; letter-spacing:.18em; text-transform:uppercase;
      color:var(--muted); font-size:11px; line-height:1;
    }

    /* Search compatta: non fa andare a capo l'header e non causa zoom su iOS */
    .pill{
      flex:1 1 240px; min-width:160px; max-width:420px;
      background:var(--bg-soft); border:1px solid var(--border); border-radius:999px;
      padding:6px 10px; display:flex; align-items:center; gap:8px;
      box-shadow:0 1px 2px rgba(0,0,0,.25);
    }
    .pill svg{flex:0 0 auto}
    .pill input{
      border:none; outline:none; background:transparent; color:var(--ink);
      font-size:16px; /* >=16px per evitare zoom iOS */
      width:100%;
    }
    .pill input::placeholder{color:#7c8591}

    /* Bottone lingua con bandiera tonda */
    .lang-btn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border); background:var(--bg-soft);
      padding:6px 10px; border-radius:999px; cursor:pointer; user-select:none;
      box-shadow:0 1px 2px rgba(0,0,0,.25); color:var(--ink);
      flex:0 0 auto;
    }
    .lang-btn:hover{border-color:var(--ring); box-shadow:0 0 0 3px var(--ring) inset}
    .lang-btn .flag{width:18px; height:18px; display:block;}
    .lang-btn .flag svg{width:18px; height:18px; display:block; border-radius:50%;}
    @media (max-width:560px){
      #langLabel{display:none;} /* su telefoni piccoli mostriamo solo la bandiera */
    }

    main{max-width:1100px; margin:18px auto 80px; padding:0 16px; display:grid; grid-template-columns:280px 1fr; gap:18px}
    nav{
      position:sticky; top:70px; align-self:start; background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      padding:10px; display:flex; flex-direction:column; gap:6px; box-shadow:0 10px 20px rgba(0,0,0,.25);
    }
    nav button{
      text-align:left; padding:10px 12px; border:none; background:transparent; border-radius:10px; cursor:pointer; color:var(--ink);
    }
    nav button .emoji{margin-right:6px}
    nav button.active, nav button:hover{background:rgba(229,192,123,.10); color:var(--accent)}

    section{ display:flex; flex-direction:column; gap:22px; }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:16px 16px 12px;
      box-shadow:0 10px 20px rgba(0,0,0,.25);
    }
    .card h2{margin:.2rem 0 10px; font-size:20px; letter-spacing:.02em}
    .grid{ display:grid; grid-template-columns:1fr auto; gap:10px 14px; align-items:start; }
    @media (max-width: 600px){ .grid{grid-template-columns:1fr} .price{justify-self:start} }
    .item-name{font-weight:600}
    .desc{color:var(--muted); font-size:13px}
    .price{ font-variant-numeric:tabular-nums; color:var(--accent); font-weight:700; justify-self:end; }
    .note{color:var(--muted); font-size:12px; margin-top:6px}

    footer{ max-width:1100px; margin:36px auto; padding:0 16px 28px; color:var(--muted); font-size:12px }

    /* Nav mobile due righe */
    @media (max-width: 880px) {
      main { grid-template-columns: 1fr; }
      nav {
        position: static;
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: max-content;
        grid-template-rows: repeat(2, auto);
        align-content: start;
        gap: 6px 8px;
        overflow-x: auto;
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 8px;
      }
      nav button { white-space: nowrap; }
    }

    @media print{
      header, nav, .pill, .lang-btn{display:none}
      body{background:#fff; color:#000}
      .card{box-shadow:none; border:1px solid #ccc}
      .price{color:#000}
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">
        <a href="#" class="wordmark" aria-label="DA.MA Milano">
          <span class="brand-text">DA<span class="sep">.</span>MA</span>
          <span class="city">Milano</span>
        </a>
      </div>

      <div class="pill" role="search">
        <!-- icona lente -->
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" d="m21 21-4.3-4.3M10 18a8 8 0 1 1 0-16a8 8 0 0 1 0 16Z"/></svg>
        <input id="q" type="search" inputmode="search" placeholder="Cerca" aria-label="Cerca" />
      </div>

      <button id="lang" class="lang-btn" title="Cambia lingua / Switch language" aria-label="Switch language">
        <span id="flag" class="flag"></span>
        <span id="langLabel">IT</span>
      </button>
    </div>
  </header>

  <main>
    <nav id="cats"></nav>
    <section id="content"></section>
  </main>

  <footer>
    <div>Prezzi e voci trascritti dal PDF allegato (pagg. 1–3). Note normalizzate per il web.</div>
  </footer>

<script>
/* =========================
   Setup lingua + bandiere
   ========================= */
const fmtEuro = (v) => Number(v).toFixed(2).replace('.', ',');
let lang = 'it'; // Italiano di default

function flagIT(){
  return `<svg viewBox="0 0 24 24" role="img" aria-label="Italiano"><defs><clipPath id="c"><circle cx="12" cy="12" r="12"/></clipPath></defs><g clip-path="url(#c)"><rect width="24" height="24" fill="#fff"/><rect x="0" width="8" height="24" fill="#008C45"/><rect x="16" width="8" height="24" fill="#CD212A"/></g></svg>`;
}
function flagEN(){
  return `<svg viewBox="0 0 24 24" role="img" aria-label="English"><defs><clipPath id="c2"><circle cx="12" cy="12" r="12"/></clipPath></defs><g clip-path="url(#c2)"><rect width="24" height="24" fill="#012169"/><rect x="10" width="4" height="24" fill="#FFF"/><rect y="10" width="24" height="4" fill="#FFF"/><rect x="11" width="2" height="24" fill="#C8102E"/><rect y="11" width="24" height="2" fill="#C8102E"/></g></svg>`;
}
function renderFlag(){
  const el = document.getElementById('flag');
  if(el) el.innerHTML = (lang==='it') ? flagIT() : flagEN();
  const lbl = document.getElementById('langLabel');
  if(lbl) lbl.textContent = lang.toUpperCase();

  // aggiorna placeholder della search in base alla lingua
  const input = document.getElementById('q');
  if(input){
    input.placeholder = (lang==='it') ? 'Cerca' : 'Search';
    input.setAttribute('aria-label', input.placeholder);
  }
}

/* =========================
   MENU completo (IT + EN + emoji)
   ========================= */
const MENU = [
  { key: "coffee",   emoji:"☕", it:"Caffetteria", en:"Coffee & Hot Drinks",
    items: [
      {it:"Espresso", en:"Espresso", price:1.30},
      {it:"Decaffeinato", en:"Decaf Espresso", price:1.40},
      {it:"Caffè Americano", en:"American Coffee", price:1.70},
      {it:"Caffè Corretto", en:"Spiked Espresso", price:1.70},
      {it:"Marocchino", en:"Marocchino Espresso", price:1.70},
      {it:"Caffè d’orzo (piccolo/grande)", en:"Barley Coffee (small/big)", price:"1.70 / 2.00"},
      {it:"Caffè al ginseng (piccolo/grande)", en:"Ginseng Coffee (small/big)", price:"1.70 / 2.00"},
      {it:"Cappuccino", en:"Cappuccino", price:1.80},
      {it:"Cappuccino (decaffeinato, soia, avena)", en:"Cappuccino (decaf, soy, oats)", price:2.00},
      {it:"Latte macchiato", en:"Latte Macchiato", price:2.50},
      {it:"Infusi", en:"Infusions", price:3.50},
      {it:"Cioccolata calda / con panna", en:"Hot Chocolate / with whipped cream", price:"4.00 / 4.50"},
      {it:"Shakerato / con alcool", en:"Shakerato / with alcohol", price:"4.00 / 4.50"},
      {it:"Spremuta d’arancia", en:"Orange Juice", price:4.00}
    ]
  },
  { key:"soft",      emoji:"🥤", it:"Bevande", en:"Soft Drinks",
    items:[
      {it:"Acqua naturale o gassata 0,5 l", en:"Water still or sparkling 0.5l", price:1.20},
      {it:"Coca Cola o Zero", en:"Coca Cola or Zero", price:3.50},
      {it:"Sprite", en:"Sprite", price:3.50},
      {it:"Fanta", en:"Fanta", price:3.50},
      {it:"Tè freddo (limone o pesca)", en:"Iced Tea (lemon or peach)", price:3.50},
      {it:"Chinotto", en:"Chinotto", price:3.50},
      {it:"Aranciata amara", en:"Aranciata Amara", price:3.50},
      {it:"Schweppes Tonica", en:"Schweppes Tonic Water", price:3.50},
      {it:"Schweppes Lemon", en:"Schweppes Lemon", price:3.50},
      {it:"Gazzosa al pompelmo", en:"Grapefruit Soda", price:3.50},
      {it:"Ginger Beer", en:"Ginger Beer", price:3.50},
      {it:"Ginger Ale", en:"Ginger Ale", price:3.50},
      {it:"Redbull", en:"Redbull", price:3.50},
      {it:"Succhi di frutta (albicocca, pesca, pera, ace, ananas, pompelmo, mirtillo, melograno)", en:"Fruit juice (apricot, peach, pear, ace, pineapple, grapefruit, blueberry, pomegranate)", price:3.50},
      {it:"Crodino", en:"Crodino", price:3.50},
      {it:"Sanbitter", en:"Sanbitter", price:3.50},
      {it:"Campari Soda", en:"Campari Soda", price:3.50}
    ],
    notes:{it:"I prezzi delle bevande variano con l’opzione aperitivo.", en:"Drink prices vary with the aperitif option."}
  },
  { key:"savory",    emoji:"🥪", it:"Il Salato", en:"Savory",
    items:[
      {it:"Toast (prosciutto cotto, fontina)", en:"Toast (ham, fontina cheese)", price:4.50},
      {it:"Toast Farcito (prosciutto cotto, brie, funghi)", en:"Stuffed Toast (ham, brie, mushrooms)", price:5.00},
      {it:"Toast Vegetariano (scamorza affumicata, verdure grigliate)", en:"Vegetarian Toast (smoked scamorza cheese, grilled vegetables)", price:5.50},
      {it:"Toast Healthy (salmone, pomodoro fresco, avocado)", en:"Healthy Toast (salmon, fresh tomato, avocado)", price:6.00},
      {it:"Uova e Bacon (strapazzate e bacon croccante)", en:"Eggs and Bacon (scrambled eggs, crispy bacon)", price:9.50},
      {it:"Piatto Brunch (salmone affumicato, avocado, uova strapazzate, bacon croccante)", en:"Brunch Plate (smoked salmon, avocado, scrambled eggs, crispy bacon)", price:14.00}
    ]
  },
  { key:"sweet",     emoji:"🍰", it:"Il Dolce", en:"Sweet",
    items:[
      {it:"Brioches", en:"Brioches", price:"da 1.00 a 1.50"},
      {it:"Pasticceria", en:"Pastry", price:"da 0.70 a 2.70"},
      {it:"Torta del giorno *", en:"Cake of the Day *", price:"3.00"},
      {it:"Paninetti al latte ripieni", en:"Stuffed Milk Sandwiches", price:"2.00"}
    ],
    notes:{it:"* I prodotti potrebbero essere congelati", en:"* The products could be frozen"}
  },
  { key:"juice",     emoji:"🧃", it:"Centrifugati", en:"Fresh Mixed Juices",
    items:[
      {it:"Ingredienti a tua scelta", en:"Ingredients of your choice", desc_it:"ananas, arancia, mela, carota, sedano, finocchio, cetriolo, zenzero", desc_en:"pineapple, orange, apple, carrot, celery, fennel, cucumber, ginger", price:7.00}
    ]
  },
  { key:"cocktails", emoji:"🍸", it:"Cocktail List", en:"Cocktail List",
    items:[
      {it:"Americano", en:"Americano", price:8.00},
      {it:"Negroni", en:"Negroni", price:9.00},
      {it:"Sbagliato", en:"Sbagliato", price:8.00},
      {it:"Spritz (Aperol, Campari, Select)", en:"Spritz (Aperol · Campari · Select)", price:8.00},
      {it:"Boulevardier", en:"Boulevardier", price:9.00},
      {it:"Mi-To", en:"Mi-To", price:8.00},
      {it:"Campari Shakerato", en:"Campari Shakerato", price:9.00},
      {it:"Mojito", en:"Mojito", price:9.00},
      {it:"Hugo Spritz", en:"Hugo Spritz", price:8.00},
      {it:"Moscow Mule", en:"Moscow Mule", price:9.00},
      {it:"Daiquiri", en:"Daiquiri", price:9.00},
      {it:"Margarita", en:"Margarita", price:9.00},
      {it:"Caipirinha", en:"Caipirinha", price:9.00},
      {it:"Rum Cooler", en:"Rum Cooler", price:9.00},
      {it:"Martini Cocktail (Gin/Dry)", en:"Martini Cocktail (Gin/Dry)", price:9.00},
      {it:"Bloody Mary", en:"Bloody Mary", price:9.00},
      {it:"Paloma", en:"Paloma", desc_en:"Mezcal, lime, grapefruit soda, sugar, salt", desc_it:"Mezcal, lime, soda al pompelmo, sciroppo di zucchero, sale", price:9.00}
    ]
  },
  { key:"wines",     emoji:"🍷", it:"Vini", en:"Wines",
    items:[
      {it:"Vini rossi (calice)", en:"Red Wine (glass)", price:6.00},
      {it:"Vini bianchi (calice)", en:"White Wine (glass)", price:6.00},
      {it:"Bollicine (calice)", en:"Sparkling Wine (glass)", price:"6.00 / 8.00"}
    ]
  },
  { key:"aperitif",  emoji:"🧀", it:"Per arricchire l’aperitivo", en:"To Enrich the Aperitif",
    items:[
      {it:"Tagliere", en:"Cold cuts & cheeses board", price:14.00, desc_it:"Salumi e formaggi a seconda della disponibilità, con marmellate e giardiniera", desc_en:"Cold cuts & cheeses depending on availability, with jams and giardiniera"},
      {it:"Pinsa Margherita", en:"Pinsa Margherita", price:10.00}
    ]
  },
  { key:"beer",      emoji:"🍺", it:"Birre", en:"Beers",
    items:[
      {it:"Menabrea Lager 0,4 l", en:"Menabrea Lager 0.4l", price:6.00},
      {it:"Menabrea 0,2 l", en:"Menabrea 0.2l", price:3.50},
      {it:"Beck’s 0,33 l", en:"Beck’s 0.33l", price:5.00},
      {it:"Corona 0,33 l", en:"Corona 0.33l", price:5.00},
      {it:"Tennent’s 0,33 l", en:"Tennent’s 0.33l", price:5.00},
      {it:"Ceres 0,33 l", en:"Ceres 0.33l", price:5.00},
      {it:"Artigianali Legnone 0,33 l (Double IPA · Strong Ale)", en:"Artigianali Legnone 0.33l (Double IPA · Strong Ale)", price:8.00}
    ]
  },
  { key:"mocktails", emoji:"🍹", it:"Alcool Free", en:"Alcohol Free",
    items:[
      {it:"VÜN", en:"VÜN", desc_it:"Succo d’ananas, sciroppo di pesca, sciroppo di cocco", desc_en:"Pineapple juice, peach syrup, coconut syrup", price:8.00},
      {it:"DÜ", en:"DÜ", desc_it:"Ginger ale, lime, menta, zucchero di canna", desc_en:"Ginger ale, lime, mint, brown sugar", price:8.00},
      {it:"TRÌ", en:"TRÌ", desc_it:"Succo di pompelmo, tonica, limone, cetriolo", desc_en:"Grapefruit juice, tonic water, lemon, cucumber", price:8.00},
      {it:"QUÀTER", en:"QUÀTER", desc_it:"Tonica, sciroppo di sambuco, soda, lime, menta", desc_en:"Tonic water, elderberry syrup, soda, lime, mint", price:8.00},
      {it:"POMODORO CONDITO", en:"Tomato Condito", desc_it:"Succo di pomodoro, salsa Worcestershire, Tabasco, limone, olio, sale, pepe", desc_en:"Tomato juice, Worcestershire sauce, Tabasco, lemon, oil, salt, pepper", price:8.00}
    ]
  },
  { key:"sandwiches", emoji:"🥙", it:"Panini e Piadine", en:"Sandwiches & Piadine",
    items:[
      {it:"Brera", en:"Brera", desc_it:"Bresaola, parmigiano, rucola, olio, limone, pepe", desc_en:"Bresaola, parmesan, rocket, oil, lemon, pepper", price:9.00},
      {it:"Porta Genova", en:"Porta Genova", desc_it:"Tacchino, squacquerone, rucola, funghi", desc_en:"Turkey, squacquerone cheese, rocket, mushrooms", price:8.00},
      {it:"San Siro", en:"San Siro", desc_it:"Pancetta, scamorza affumicata, zucchine grigliate", desc_en:"Pancetta, smoked scamorza cheese, grilled zucchini", price:8.00},
      {it:"Sant’Ambrogio", en:"Sant’Ambrogio", desc_it:"Speck, brie, rucola", desc_en:"Speck, brie, rocket", price:8.00},
      {it:"Barona", en:"Barona", desc_it:"Prosciutto crudo, formaggio spalmabile, rucola, pomodori secchi", desc_en:"Raw ham, spreadable cheese, rocket, dried tomatoes", price:9.00},
      {it:"Centrale", en:"Centrale", desc_it:"Prosciutto cotto, mozzarella, gamberetti, insalata, salsa rosa", desc_en:"Ham, mozzarella cheese, shrimps, salad, pink sauce", price:9.00},
      {it:"Missori", en:"Missori", desc_it:"Prosciutto crudo, mozzarella, zucchine grigliate", desc_en:"Raw ham, mozzarella cheese, grilled zucchini", price:8.00},
      {it:"Duomo di Monza", en:"Duomo di Monza", desc_it:"Prosciutto crudo, squacquerone, rucola", desc_en:"Raw ham, squacquerone cheese, rocket", price:8.00},
      {it:"Duomo", en:"Duomo", desc_it:"Squacquerone, pomodoro fresco, verdure grigliate", desc_en:"Squacquerone cheese, fresh tomato, grilled vegetables", price:9.00},
      {it:"Navigli", en:"Navigli", desc_it:"Salmone affumicato, formaggio spalmabile, avocado, pomodoro fresco, limone, pepe", desc_en:"Smoked salmon, spreadable cheese, avocado, fresh tomato, lemon, pepper", price:9.00},
      {it:"De Angeli", en:"De Angeli", desc_it:"Mortadella, burrata, rucola e melanzane grigliate", desc_en:"Mortadella, burrata cheese, rocket & grilled aubergines", price:9.00},
      {it:"Garibaldi", en:"Porta Garibaldi", desc_it:"", desc_en:"", price:7.00},
      {it:"Porchetta", en:"Porchetta", desc_it:"Porchetta montanara", desc_en:"Mountain-style porchetta", price:10.00},
      {it:"Club Sandwich", en:"Club Sandwich", desc_it:"Tacchino, bacon, pomodoro fresco, insalata, maionese", desc_en:"Turkey, bacon, fresh tomato, salad, mayonnaise", price:10.00},
      {it:"Club Vegetariano", en:"Club Vegetariano", desc_it:"Scamorza affumicata, pomodoro fresco, verdure grigliate", desc_en:"Smoked scamorza, fresh tomato, grilled vegetables", price:10.00}
    ]
  },
  { key:"salads",    emoji:"🥗", it:"Insalate", en:"Salads",
    items:[
      {it:"Greca", en:"Greek", desc_it:"Misticanza, feta, pomodoro fresco, cetrioli, cipolla rossa, olive nere, origano", desc_en:"Mixed salad, feta cheese, fresh tomato, cucumbers, red onion, black olives, oregano", price:10.00},
      {it:"Cesar Salad", en:"Cesar Salad", desc_it:"Misticanza, pollo alla griglia*, scaglie di parmigiano, pomodoro fresco, salsa cesar", desc_en:"Mixed salad, grilled chicken*, parmesan flakes, fresh tomato, cesar sauce", price:10.00},
      {it:"Mediterranea", en:"Mediterranean", desc_it:"Misticanza, tonno sott’olio, mozzarella, pomodoro fresco, olive nere, origano", desc_en:"Mixed salad, tuna in oil, mozzarella cheese, fresh tomato, black olives, oregano", price:11.00},
      {it:"Nord Sud", en:"North South", desc_it:"Misticanza, bresaola, burrata, pomodoro fresco, melanzane grigliate", desc_en:"Mixed salad, bresaola, burrata cheese, fresh tomato, grilled aubergines", price:11.00},
      {it:"Estiva", en:"Summer", desc_it:"Misticanza, salmone affumicato, finocchi julienne, pomodoro fresco, olive nere", desc_en:"Mixed salad, smoked salmon, julienne fennel, fresh tomato, black olives", price:12.00},
      {it:"Maiolistica", en:"Maiolistica", desc_it:"Misticanza, salmone affumicato, avocado, pomodoro fresco, arancia, semi di sesamo e papavero", desc_en:"Mixed salad, smoked salmon, avocado, fresh tomato, orange, sesame seeds and poppy", price:12.00}
    ]
  }
];

/* =========================
   Helpers e stato DOM
   ========================= */
function money(v){
  if(typeof v === 'number') return '€ ' + fmtEuro(v);
  if(typeof v === 'string' && v.includes('/')) {
    return '€ ' + v.split('/').map(s => s.trim()).join(' / € ');
  }
  return v || '';
}

const cats = document.getElementById('cats');
const content = document.getElementById('content');
const q = document.getElementById('q');
const langBtn = document.getElementById('lang');
const langLabel = document.getElementById('langLabel');

/* =========================
   NAV (emoji)
   ========================= */
function renderCats(){
  cats.innerHTML = '';
  MENU.forEach((c, i) => {
    const b = document.createElement('button');
    b.innerHTML = (c.emoji ? `<span class="emoji">${c.emoji}</span>` : '') + (lang === 'it' ? c.it : c.en);
    b.className = i===0 ? 'active' : '';
    b.addEventListener('click', () => {
      [...cats.querySelectorAll('button')].forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      if (q.value.trim()) {
        renderAllSections();   // con ricerca attiva: vista globale
      } else {
        renderSection(c.key);  // altrimenti sezione scelta
      }
    });
    cats.appendChild(b);
  });
}

/* =========================
   Rendering sezione singola
   ========================= */
function buildCategoryCard(cat, items){
  const card = document.createElement('div'); card.className='card';
  const h2 = document.createElement('h2');
  h2.textContent = (cat.emoji ? cat.emoji + ' ' : '') + (lang==='it'?cat.it:cat.en);
  card.appendChild(h2);

  const grid = document.createElement('div'); grid.className='grid';
  items.forEach(it => {
    const name = lang==='it'? it.it : it.en;
    const desc = lang==='it'? (it.desc_it||'') : (it.desc_en||'');

    const nameEl = document.createElement('div'); nameEl.className='item-name'; nameEl.textContent = name;
    grid.appendChild(nameEl);

    const priceEl = document.createElement('div'); priceEl.className='price'; priceEl.textContent = money(it.price);
    grid.appendChild(priceEl);

    if(desc){
      const d = document.createElement('div'); d.className='desc'; d.textContent = desc; grid.appendChild(d);
      grid.appendChild(document.createElement('div'));
    }
  });
  card.appendChild(grid);

  if(cat.notes && (cat.notes.it || cat.notes.en)){
    const note = document.createElement('div'); note.className='note';
    note.textContent = lang==='it' ? (cat.notes.it || '') : (cat.notes.en || '');
    card.appendChild(note);
  }
  return card;
}

function renderSection(key){
  const cat = MENU.find(x => x.key===key) || MENU[0];
  content.innerHTML = '';
  content.appendChild(buildCategoryCard(cat, cat.items));
}

/* =========================
   Ricerca globale
   ========================= */
function renderAllSections(){
  const term = (q.value || '').trim().toLowerCase();
  content.innerHTML = '';
  MENU.forEach(cat => {
    const matched = cat.items.filter(it => {
      const name = lang === 'it' ? it.it : it.en;
      const desc = lang === 'it' ? (it.desc_it || '') : (it.desc_en || '');
      return (name + ' ' + desc).toLowerCase().includes(term);
    });
    if (!term || matched.length > 0) {
      if (!term) return; // vista standard gestita da renderSection
      content.appendChild(buildCategoryCard(cat, matched));
    }
  });

  if (term && content.children.length === 0) {
    const empty = document.createElement('div'); empty.className = 'card';
    empty.innerHTML = `<h2>🔎 Nessun risultato</h2><div class="desc">Prova con un'altra parola.</div>`;
    content.appendChild(empty);
  }
}

/* =========================
   Wiring lingua + ricerca
   ========================= */
function renderAll(){
  renderCats();
  renderSection(MENU[0].key);
  if (langLabel) langLabel.textContent = lang.toUpperCase();
  renderFlag();
}

langBtn.addEventListener('click', () => {
  lang = (lang==='it') ? 'en' : 'it';
  renderFlag();
  if (q.value.trim()) {
    renderCats();
    renderAllSections();
  } else {
    renderAll();
  }
});

q.addEventListener('input', () => {
  if (q.value.trim()) {
    renderAllSections();
  } else {
    const current = document.querySelector('#cats button.active');
    const idx = [...cats.children].indexOf(current);
    const key = MENU[idx >= 0 ? idx : 0].key;
    renderSection(key);
  }
});

renderAll();
</script>
</body>
</html>
